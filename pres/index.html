<style>
 .column1 {
     float: left;
     /* width: 29%; */
     padding-right: 20px;
     padding-bottom: 20px;
     /* overflow:overlay */
 }
 .column2a {
     overflow-y:auto;
 }
 .column2b {
     /* float: left; */
     /* width: 29%; */
     height: 48%;
     overflow-y:auto
 }
 .column2c {
     /* float: left; */
     /* width: 29%; */
     height: 48%;
 }
 .column2 {
     /* float: left; */
     /* width: 100%; */
     margin-left: 20px;
     margin-right: 20px;
     height: 100%;
     overflow-x:auto
 }
 .column3 {
     float: right;
     /* width: 33.3%; */
     padding-left: 20px;
 }

 /* Clear floats after the columns */
 .row:after {
     content: "";
     width:100%;
     display: table;
     clear: both;
 }

 textarea {
     /* Don't allow resize of textareas */
     resize: none;
     /* width: 100%; */
     cols: 100;
     height: 95%;
 }
 input {
     resize: none;
     width: 98%;
 }
 img {
     /* width: 100%; */
     height: 100%;
     /* height: 300px; */
     object-fit: contain;
     display: block;
     margin-left: auto;
     margin-right: auto;
}
div {
    /* outline: 2px dashed blue; */
}
</style>
<body>
<div class="row">
    <div class="column1">
        Modular program: <br>
        <textarea id="modular" rows="50" cols="80"></textarea>
        <br>
        <button id="compile" onclick="compile()" style="width:100%;">Generate</button>
    </div>
    <div class="column3">
        Concrete program: <br>
        <textarea id="concrete" rows="50" cols="80" readonly></textarea>
    </div>
    <div class="column2">
        <div class="column2a">
            Selection: <br>
            <input id="selection">
        </div>
        <div class="column2b">
            <!-- Model graph: <br> -->
            <image id="model-graph" src="/home/ryan/projects/mockup/golf-models.png">
        </div>
        <div class="column2c">
            <!-- Module graph: <br> -->
            <image id="module-graph" src="/home/ryan/projects/mockup/golf-modules.png">
        </div>
    </div>
</div>

<script>
 document.getElementById("modular").value =
`model {
    A() + B();
}

module "a1" A() {
    return 1;
}
module "a2" A() {
    return 2;
}
module "b3" B() {
    return 3;
}
module "b4" B() {
    return 4;
}`;
 document.getElementById("selection").value = `A:a2,B:b4`;


 const myPort = 12345;

 function select(selections, prog, callback) {
     webSocket = new WebSocket("ws://127.0.0.1:" + myPort);
     webSocket.onopen = function () {
         webSocket.send("select\n" + selections + "\n" + prog);
     }
     webSocket.onmessage = function (event) {
         callback(event.data);
         /* promise  */
     }
 }

 function moduleGraph(prog, callback) {
     webSocket = new WebSocket("ws://127.0.0.1:" + myPort);
     webSocket.onopen = function () {
         webSocket.send("module-graph\n" + prog);
     }
     webSocket.onmessage = function (event) {
         callback(event.data);
     }
 }

 function modelGraph(prog, callback) {
     webSocket = new WebSocket("ws://127.0.0.1:" + myPort);
     webSocket.onopen = function () {
         webSocket.send("model-graph\n" + prog);
     }
     webSocket.onmessage = function (event) {
         callback(event.data);
         /* promise  */
     }
 }

 function updateModelGraph() {
     var modular = document.getElementById("modular").value;
     var modelgraph_callback = function (modelgraph) {
         document.getElementById("model-graph").src = modelgraph;
         updateModuleGraph();
     }
     modelGraph(modular, modelgraph_callback);
 }

 function updateModuleGraph() {
     var modular = document.getElementById("modular").value;
     var modulegraph_callback = function (modulegraph) {
         document.getElementById("module-graph").src = modulegraph;
         updateSelection();
     }
     moduleGraph(modular, modulegraph_callback);
 }

 function updateSelection() {
     var modular = document.getElementById("modular").value;
     var selection = document.getElementById("selection").value;
     var select_callback = function (concrete) {
         document.getElementById("concrete").value = concrete;
     }
     select(selection, modular, select_callback);
 }

 function compile() {
     updateModelGraph();
 }

</script>

</body>
